<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ChemE Units — Engineering Unit Converter</title>
  <meta name="description" content="Dimensional analysis unit converter and chemistry calculator for chemical engineering students. Convert compound units, calculate molar mass, look up constants, and balance chemical equations.">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="index.css">
</head>
<body>

  <!-- Loading Screen -->
  <div id="app-loading" style="min-height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:16px;position:relative;z-index:1">
    <div style="width:52px;height:52px;background:hsl(212,90%,48%);border-radius:14px;display:flex;align-items:center;justify-content:center;animation:pulse 1.5s ease infinite">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M9 3H5a2 2 0 0 0-2 2v4m6-6h10a2 2 0 0 1 2 2v4M9 3v18m0 0h10a2 2 0 0 0 2-2V9M9 21H5a2 2 0 0 1-2-2V9m0 0h18"/>
      </svg>
    </div>
    <div style="font-size:18px;font-weight:700;color:hsl(220,15%,12%);letter-spacing:-0.4px">ChemE Units</div>
    <div style="display:flex;gap:6px;align-items:center;color:hsl(220,8%,58%);font-size:13px">
      <span class="loading-dot" style="animation-delay:0s"></span>
      <span class="loading-dot" style="animation-delay:0.2s"></span>
      <span class="loading-dot" style="animation-delay:0.4s"></span>
      <span style="margin-left:6px">Loading databases…</span>
    </div>
  </div>

  <!-- Main App -->
  <div id="app-content" style="display:none">
    <div id="app">

      <!-- Header -->
      <header class="app-header">
        <div class="app-logo">
          <div class="logo-icon">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M9 3H5a2 2 0 0 0-2 2v4m6-6h10a2 2 0 0 1 2 2v4M9 3v18m0 0h10a2 2 0 0 0 2-2V9M9 21H5a2 2 0 0 1-2-2V9m0 0h18"/>
            </svg>
          </div>
          <div>
            <div class="logo-text">ChemE Units</div>
            <div class="logo-sub">Dimensional Analysis Calculator</div>
          </div>
        </div>
        <span class="header-badge" id="data-badge">Loading…</span>
      </header>

      <!-- Desktop Tab Navigation -->
      <nav class="tab-nav" role="tablist" aria-label="Application tabs">
        <button class="tab-btn active" data-tab="converter" role="tab" aria-selected="true" id="tab-btn-converter">
          Converter
        </button>
        <button class="tab-btn" data-tab="molar" role="tab" aria-selected="false" id="tab-btn-molar">
          Molar Mass
        </button>
        <button class="tab-btn" data-tab="periodic" role="tab" aria-selected="false" id="tab-btn-periodic">
          Periodic Table
        </button>
        <button class="tab-btn" data-tab="constants" role="tab" aria-selected="false" id="tab-btn-constants">
          Constants
        </button>
        <button class="tab-btn" data-tab="balancer" role="tab" aria-selected="false" id="tab-btn-balancer">
          Eq. Balancer
        </button>
        <button class="tab-btn" data-tab="library" role="tab" aria-selected="false" id="tab-btn-library" style="display:none">
          Unit Library
        </button>
      </nav>

      <!-- Mobile Bottom Navigation -->
      <nav class="mobile-nav" aria-label="Mobile navigation">
        <button class="mobile-nav-btn active" data-tab="converter">
          <span class="mob-icon">⇌</span>
          <span>Convert</span>
        </button>
        <button class="mobile-nav-btn" data-tab="molar">
          <span class="mob-icon">⚗</span>
          <span>Molar</span>
        </button>
        <button class="mobile-nav-btn" data-tab="periodic">
          <span class="mob-icon">⊞</span>
          <span>Table</span>
        </button>
        <button class="mobile-nav-btn" data-tab="constants">
          <span class="mob-icon">K</span>
          <span>Constants</span>
        </button>
        <button class="mobile-nav-btn" data-tab="balancer">
          <span class="mob-icon">≡</span>
          <span>Balancer</span>
        </button>
        <button class="mobile-nav-btn" data-tab="library">
          <span class="mob-icon">≈</span>
          <span>Library</span>
        </button>
      </nav>

      <!-- Tab Content -->
      <div class="tab-content">

        <!-- ═══ TAB: CONVERTER ═══ -->
        <div id="tab-converter" class="tab-panel active">
          <h1 class="section-header">Unit Converter</h1>
          <p class="section-sub">Dimensional analysis — all conversions validated for physical consistency.</p>

          <!-- Favorites section -->
          <div class="fav-section" id="fav-section" style="display:none">
            <div class="card-title">Favorites</div>
            <div class="fav-items" id="fav-items"></div>
          </div>

          <!-- Converter workspace: input+examples | library panel -->
          <div class="converter-workspace">
            <div>
              <div class="converter-grid">
                <!-- Input panel -->
                <div class="card converter-panel">
                  <div class="card-title">Input</div>

                  <div class="input-group">
                    <label class="input-label" for="value-input">Value</label>
                    <input id="value-input" class="input-field" type="number"
                      placeholder="e.g. 101.325"
                      value="1"
                      step="any" autocomplete="off"
                      aria-label="Numeric value to convert">
                  </div>

                  <div class="input-group">
                    <label class="input-label" for="src-unit">From Unit</label>
                    <input id="src-unit" class="input-field" type="text"
                      placeholder="e.g. atm, kg/m^3, kJ/mol"
                      autocomplete="off" spellcheck="false"
                      aria-label="Source unit expression">
                    <span class="input-hint">Use * for multiplication: kg*m/s^2 · N*m · W/(m^2*K)</span>
                  </div>

                  <div style="display:flex;justify-content:center;margin:4px 0">
                    <button class="swap-btn" id="swap-btn" title="Swap units" aria-label="Swap units">⇅</button>
                  </div>

                  <div class="input-group">
                    <label class="input-label" for="tgt-unit">To Unit</label>
                    <input id="tgt-unit" class="input-field" type="text"
                      placeholder="e.g. Pa, lb/ft^3, BTU/lbmol"
                      autocomplete="off" spellcheck="false"
                      aria-label="Target unit expression">
                  </div>

                  <button class="convert-btn" id="convert-btn" style="margin-top:8px" aria-label="Convert units">
                    Convert
                  </button>
                </div>

                <!-- Quick examples panel -->
                <div class="card">
                  <div class="card-title">Quick Examples</div>
                  <div style="display:flex;flex-direction:column;gap:7px" id="examples-list"></div>

                  <div style="margin-top:16px;border-top:1px solid var(--border);padding-top:14px">
                    <div class="card-title" style="margin-bottom:10px">Accepted Formats</div>
                    <div style="display:flex;flex-direction:column;gap:5px;font-family:var(--font-mono);font-size:12px;color:var(--text-secondary)">
                      <div><span style="color:var(--accent-primary)">kg*m/s^2</span> — asterisk multiplication</div>
                      <div><span style="color:var(--accent-primary)">kg/m3</span> — inline exponent</div>
                      <div><span style="color:var(--accent-primary)">kg/m^3</span> — caret exponent</div>
                      <div><span style="color:var(--accent-primary)">kg per m3</span> — "per" as divisor</div>
                      <div><span style="color:var(--accent-primary)">kJ/(mol*K)</span> — parenthesised denominator</div>
                      <div><span style="color:var(--accent-primary)">N*m/s^2</span> — compound numerator</div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Result -->
              <div id="converter-output"></div>
            </div>

            <!-- Unit library panel (desktop) -->
            <div class="unit-library-panel">
              <div class="card-title" style="margin-bottom:8px">Unit Library</div>
              <input id="library-search" class="input-field library-search" type="text"
                placeholder="Search units…" autocomplete="off" spellcheck="false"
                aria-label="Search unit library">
              <div style="display:grid;grid-template-columns:56px 1fr 80px;gap:6px;padding:4px 8px;margin-top:4px">
                <span style="font-size:10px;color:var(--text-muted);text-transform:uppercase;letter-spacing:0.5px">Symbol</span>
                <span style="font-size:10px;color:var(--text-muted);text-transform:uppercase;letter-spacing:0.5px">Name</span>
                <span style="font-size:10px;color:var(--text-muted);text-transform:uppercase;letter-spacing:0.5px;text-align:right">Quantity</span>
              </div>
              <div class="library-list" id="library-list"></div>
            </div>
          </div>
        </div>

        <!-- ═══ TAB: MOLAR MASS ═══ -->
        <div id="tab-molar" class="tab-panel">
          <h1 class="section-header">Molar Mass Calculator</h1>
          <p class="section-sub">Calculate molecular weight from a chemical formula using IUPAC 2021 atomic weights.</p>

          <div class="molar-layout">
            <div class="card" style="display:flex;flex-direction:column;gap:var(--gap-md)">
              <div class="card-title">Formula Input</div>
              <div class="input-group">
                <label class="input-label" for="molar-formula-input">Chemical Formula</label>
                <input id="molar-formula-input" class="input-field" type="text"
                  placeholder="e.g. H2O, H2SO4, C6H12O6"
                  autocomplete="off" spellcheck="false"
                  style="font-size:20px;padding:14px 16px"
                  aria-label="Chemical formula">
                <span class="input-hint">Supports: nested groups Ca(OH)₂, hydrates CuSO₄·5H₂O</span>
              </div>
              <button class="convert-btn" id="molar-calc-btn" aria-label="Calculate molar mass">
                Calculate
              </button>

              <div style="margin-top:4px">
                <div class="card-title" style="margin-bottom:10px">Quick Examples</div>
                <div style="display:flex;flex-wrap:wrap;gap:7px">
                  <button class="formula-chip" data-formula="H2O">H₂O</button>
                  <button class="formula-chip" data-formula="CO2">CO₂</button>
                  <button class="formula-chip" data-formula="H2SO4">H₂SO₄</button>
                  <button class="formula-chip" data-formula="NaCl">NaCl</button>
                  <button class="formula-chip" data-formula="C6H12O6">C₆H₁₂O₆</button>
                  <button class="formula-chip" data-formula="Ca(OH)2">Ca(OH)₂</button>
                  <button class="formula-chip" data-formula="Al2(SO4)3">Al₂(SO₄)₃</button>
                  <button class="formula-chip" data-formula="C8H18">C₈H₁₈</button>
                  <button class="formula-chip" data-formula="KMnO4">KMnO₄</button>
                  <button class="formula-chip" data-formula="Fe2O3">Fe₂O₃</button>
                </div>
              </div>
            </div>

            <div id="molar-output">
              <div class="card" style="color:var(--text-muted);text-align:center;padding:40px 20px;font-size:14px">
                Enter a chemical formula and press <strong style="color:var(--text-secondary)">Calculate</strong> or press Enter.
              </div>
            </div>
          </div>
        </div>

        <!-- ═══ TAB: PERIODIC TABLE ═══ -->
        <div id="tab-periodic" class="tab-panel">
          <h1 class="section-header">Periodic Table</h1>
          <p class="section-sub">Click any element to view its properties. IUPAC 2021 atomic weights.</p>

          <div class="pt-info" id="pt-info">
            <div style="color:var(--text-muted);font-size:14px;width:100%;text-align:center">
              Click an element to see its properties.
            </div>
          </div>

          <div class="pt-search-wrap">
            <input id="pt-search" class="input-field" type="text"
              placeholder="Search by name, symbol, Z, or category…"
              style="font-family:var(--font-sans);font-size:14px"
              aria-label="Search periodic table">
          </div>

          <div class="pt-legend" id="pt-legend"></div>

          <div style="overflow-x:auto;padding-bottom:8px">
            <div class="pt-grid" id="pt-grid"></div>
          </div>
        </div>

        <!-- ═══ TAB: CONSTANTS ═══ -->
        <div id="tab-constants" class="tab-panel">
          <h1 class="section-header">Engineering Constants</h1>
          <p class="section-sub">CODATA 2018 values. Click any card to copy symbol = value unit to clipboard.</p>

          <div class="constants-search-row">
            <input id="constants-search" class="input-field" type="text"
              placeholder="Search by name, symbol, unit, or description…"
              aria-label="Search engineering constants">
          </div>

          <div class="category-filter" id="cat-filters" style="margin-bottom:var(--gap-lg)"></div>

          <div class="constants-grid" id="constants-grid"></div>
        </div>

        <!-- ═══ TAB: EQUATION BALANCER ═══ -->
        <div id="tab-balancer" class="tab-panel">
          <h1 class="section-header">Equation Balancer</h1>
          <p class="section-sub">Balance chemical equations automatically using matrix algebra.</p>

          <div class="balancer-layout">
            <!-- Input panel -->
            <div class="card balancer-input-panel">
              <div class="card-title">Equation Input</div>

              <div class="input-group">
                <label class="input-label" for="eq-input">Chemical Equation</label>
                <input id="eq-input" class="input-field" type="text"
                  placeholder="e.g. H2 + O2 -> H2O"
                  autocomplete="off" spellcheck="false"
                  style="font-size:16px"
                  aria-label="Chemical equation to balance">
                <span class="input-hint">Use + between compounds · use -> or → as reaction arrow · parentheses Ca(OH)2 supported</span>
              </div>

              <!-- Redox toggle -->
              <div class="toggle-row">
                <label class="toggle-switch">
                  <input type="checkbox" id="redox-toggle">
                  <span class="toggle-track"></span>
                </label>
                <label class="toggle-label" for="redox-toggle">Redox Reaction Mode</label>
              </div>

              <!-- Medium selector (shown only in redox mode) -->
              <div id="redox-options" class="redox-options" style="display:none">
                <label class="input-label" style="align-self:center">Solution:</label>
                <select class="solution-select" id="medium-select" aria-label="Solution type">
                  <option value="acidic">Acidic solution</option>
                  <option value="basic">Basic solution</option>
                </select>
              </div>

              <button class="convert-btn" id="balance-btn" aria-label="Balance equation">
                Balance
              </button>

              <!-- Result output -->
              <div id="balancer-output"></div>
            </div>

            <!-- Examples panel -->
            <div class="card">
              <div class="card-title">Quick Examples</div>
              <div class="balancer-examples" id="balancer-examples"></div>

              <div style="margin-top:16px;border-top:1px solid var(--border);padding-top:14px">
                <div class="card-title" style="margin-bottom:10px">Input Format</div>
                <div style="display:flex;flex-direction:column;gap:5px;font-family:var(--font-mono);font-size:12px;color:var(--text-secondary)">
                  <div><span style="color:var(--accent-primary)">H2 + O2 -> H2O</span></div>
                  <div><span style="color:var(--accent-primary)">Fe + O2 → Fe2O3</span></div>
                  <div><span style="color:var(--accent-primary)">Ca(OH)2 + HCl -> CaCl2 + H2O</span></div>
                  <div style="color:var(--text-muted);font-size:11px;margin-top:4px">Subscripts written as plain numbers · parentheses supported · spaces ignored</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ═══ TAB: UNIT LIBRARY (mobile dedicated tab) ═══ -->
        <div id="tab-library" class="tab-panel">
          <h1 class="section-header">Unit Library</h1>
          <p class="section-sub">Reference list of all supported unit symbols. Tap a unit to pre-fill the converter.</p>

          <div class="card" style="padding:var(--gap-md)">
            <input id="library-search-mobile" class="input-field library-search" type="text"
              placeholder="Search units…" autocomplete="off" spellcheck="false"
              aria-label="Search unit library">
            <div style="display:grid;grid-template-columns:56px 1fr 90px;gap:6px;padding:8px 8px 4px;margin-top:8px">
              <span style="font-size:10px;color:var(--text-muted);text-transform:uppercase;letter-spacing:0.5px">Symbol</span>
              <span style="font-size:10px;color:var(--text-muted);text-transform:uppercase;letter-spacing:0.5px">Name</span>
              <span style="font-size:10px;color:var(--text-muted);text-transform:uppercase;letter-spacing:0.5px;text-align:right">Quantity</span>
            </div>
            <div class="library-list" id="library-list-mobile" style="max-height:65vh;overflow-y:auto"></div>
          </div>
        </div>

      </div><!-- /.tab-content -->
    </div><!-- /#app -->
  </div><!-- /#app-content -->

  <!-- Scripts: engine first, then modules, then app entry -->
  <script src="js/engine.js"></script>
  <script src="js/molar_mass.js"></script>
  <script src="js/equation_balancer.js"></script>
  <script src="js/ui_converter.js"></script>
  <script src="js/ui_molar.js"></script>
  <script src="js/ui_periodic.js"></script>
  <script src="js/ui_constants.js"></script>
  <script src="js/ui_favorites.js"></script>
  <script src="js/ui_library.js"></script>
  <script src="js/ui_balancer.js"></script>
  <script src="js/app.js"></script>

  <!-- Quick examples (inline, no extra fetch) -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const examples = [
        { label:'1 atm → Pa',          value:'1',      src:'atm',       tgt:'Pa'       },
        { label:'1 Pa → atm',          value:'1',      src:'Pa',        tgt:'atm'      },
        { label:'1 kg/m³ → lb/ft³',    value:'1',      src:'kg/m^3',    tgt:'lb/ft^3'  },
        { label:'1 kJ/mol → J/mol',    value:'1',      src:'kJ/mol',    tgt:'J/mol'    },
        { label:'1 N/m² → Pa',         value:'1',      src:'N/m^2',     tgt:'Pa'       },
        { label:'1 BTU → J',           value:'1',      src:'BTU',       tgt:'J'        },
        { label:'1 hp → W',            value:'1',      src:'hp',        tgt:'W'        },
        { label:'60 mph → m/s',        value:'60',     src:'mph',       tgt:'m/s'      },
        { label:'1 bar → Pa',          value:'1',      src:'bar',       tgt:'Pa'       },
        { label:'1 g/mL → kg/m³',      value:'1',      src:'g/mL',      tgt:'kg/m^3'   },
      ];

      const list = document.getElementById('examples-list');
      if (!list) return;

      list.innerHTML = examples.map((ex, i) =>
        `<button class="example-btn" id="ex-btn-${i}">${ex.label}</button>`
      ).join('');

      examples.forEach((ex, i) => {
        document.getElementById(`ex-btn-${i}`).addEventListener('click', () => {
          document.getElementById('value-input').value = ex.value;
          document.getElementById('src-unit').value    = ex.src;
          document.getElementById('tgt-unit').value    = ex.tgt;
          document.getElementById('convert-btn').click();
        });
      });

      // Wire up mobile library search to delegate to LibraryUI
      const mobileSearch = document.getElementById('library-search-mobile');
      if (mobileSearch) {
        mobileSearch.addEventListener('input', () => {
          // Render into mobile list
          const q = mobileSearch.value.trim().toLowerCase();
          const mobileList = document.getElementById('library-list-mobile');
          if (window.LibraryUI && mobileList) {
            // Re-use LibraryUI render logic by temporarily swapping container
            const origSearch = document.getElementById('library-search');
            if (origSearch) origSearch.value = mobileSearch.value;
            // Trigger the desktop search input event to rerender both
            origSearch?.dispatchEvent(new Event('input'));
            // Copy rendered html to mobile list
            setTimeout(() => {
              const src = document.getElementById('library-list');
              if (src) mobileList.innerHTML = src.innerHTML;
            }, 10);
          }
        });
      }
    });
  </script>

</body>
</html>
